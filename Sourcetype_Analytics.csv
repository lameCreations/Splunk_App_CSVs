metric_description,metric_query,sourcetype
Look for non US keyboard layouts.  RDP sessions will track keyboard layouts.,"index=corelight sourcetype=corelight_rdp keyboard_layout!=""English - United States"" | stats count by keyboard_layout, src_ip, dest_ip",corelight_rdp
Screen Resolution of less than 800x600 can be an indication of a script or automated rdp attempt.,index=corelight sourcetype=corelight_rdp desktop_height&amp;lt;600 desktop_width&amp;lt;800,corelight_rdp
Look for Source IP being below 1024.  Might indicate a reverse tunnel or a switch of src and dest,"index=corelight sourcetype=corelight_conn src_port&lt;9999 service in (http, ssl, rdp, ssh) ",corelight_conn
Look at the DNS text response and see if it contains ascii characters,"index=corelight sourcetype=corelight_dns (answers="".*[^\\x00-\\x7f].*"")  qtype_name=txt",corelight_dns
Look for multiple failed DNS requests.,"index=corelight sourcetype=corelight_dns (rcode_name=""NXDOMAIN"" OR rcode_name=""SERVFAIL"" OR rcode_name=""nxdomain"" OR rcode_name=""servfail"")  | eventstats dc(query) as val by dest_ip | search val > 25 | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,qtype_name,qtype,query,answers,rcode,rcode_name,trans_id,qtype,ttl,AA,uid",corelight_dns
Look for custom crypto being used.,"index=corelight sourcetype=corelight_notice note=""Viz::CustomCrypto"" | table ts,id.orig_h,id.orig_p,id.resp_h,id.resp_p,proto,p,src,dst,actions,msg,note,fuid,uid",corelight_notice
Potential enumeration of user accounts on a domain controller.  ,"index=corelight sourcetype=corelight_dce_rpc (operation=""LsarLookupNames3"" OR operation=""LsarLookupSids3"" OR operation=""SamrGetGroupsForUser"" OR operation=""SamrLookupIdsInDomain"" OR operation=""SamrLookupNamesInDomain"" OR operation=""SamrQuerySecurityObject"" OR operation=""SamrQueryInformationGroup"") | eventstats dc(operation) as val by id_orig_h | search val > 6 | table ts,src_ip,src_port,dest_ip,dest_port,endpoint,named_pipe,operation,uid",corelight_dce_rpc
Potential WebDav download.  Webdav allows files to be download and executed from a remote server.,"index=corelight sourcetype=corelight_http ((c-useragent=""*WebDAV*"" OR uri=""*webdav*"") (resp_mime_types=""*dosexec*"" OR uri=""*.exe"")) | table ts,src_ip,src_port,dest_ip,dest_port,host,method,version,user_agent,status_code,status_msg,uri,referrer,request_body_len,response_body_len,orig_mime_types,resp_mime_types,proxied,origin,orig_fuids,resp_fuids,uid",corelight_http
External Proxy Usage,"index=corelight sourcetype=corelight_http (proxied=""*"" NOT (((src_ip=""10.*"" OR src_ip=""192.168.*"" OR src_ip=""172.16..0.0/14"" OR src_ip=""127.*"" OR src_ip=""169.254.*"") OR src_ip=""::1"" OR (src_ip=""fe80::*"" OR src_ip=""fc00::*"")))) | table host,src_ip,dest_ip,proxied",corelight_http
Potential malicious mime and service type combinations,"index=corelight sourcetype=corelight_http  ((((resp_mime_types=""application/java-archive"" OR resp_mime_types=""application/mshelp"" OR resp_mime_types=""application/chrome-ext"" OR resp_mime_types=""application/x-object"" OR resp_mime_types=""application/x-executable"" OR resp_mime_types=""application/x-sharedlib"" OR resp_mime_types=""application/x-mach-o-executable"" OR resp_mime_types=""application/x-dosexec"" OR resp_mime_types=""application/x-java-applet"" OR resp_mime_types=""application/x-java-jnlp-file"" OR resp_mime_types=""text/x-php"" OR resp_mime_types=""text/x-perl"" OR resp_mime_types=""text/x-ruby"" OR resp_mime_types=""text/x-python"" OR resp_mime_types=""text/x-awk"" OR resp_mime_types=""text/x-tcl"" OR resp_mime_types=""text/x-lua"" OR resp_mime_types=""text/x-msdos-batch"") (user_agent=""*certutil*"" OR user_agent=""*powershell*"" OR user_agent=""*microsoft*"" OR user_agent=""*python*"" OR user_agent=""*libwww-perl*"" OR user_agent=""*go-http*"" OR user_agent=""*java/*"" OR user_agent=""*lua-resty-http*"" OR user_agent=""*winhttp*"" OR user_agent=""*vb project*"" OR user_agent=""*ruby*"")) NOT ((id.orig_p=""80"" OR id.orig_p=""8000"" OR id.orig_p=""8080"" OR id.orig_p=""8888"")))  ((id.resp_h=""10.*"" OR id.resp_h=""192.168.*"" OR id.resp_h=""172.16.0.0/14"" OR id.resp_h=""127.*"" OR id.resp_h=""169.254.*"") OR id.resp_h=""::1"" OR (id.resp_h=""fe80::*"" OR id.resp_h=""fc00::*"")))",corelight_http
Direct download from a link,"index=corelight sourcetype=corelight_http ((method=""GET"" (uri=""*.lnk"" OR uri=""*.LNK"" OR uri=""*.inf"" OR uri=""*.INF"")) NOT (referrer=""*""))",corelight_http
SMB download from a link,"index=corelight sourcetype=corelight_smb_files (name=""*.lnk"" OR name=""*.LNK"" OR name=""*.inf"" OR name=""*.INF"")",corelight_smb_files
Large number of queries from a single IP over a short amount of time may indicate malware,tbd,corelight_dns
entropy on the query name may indicate dga or malicous site,tbd,corelight_dns
abnormal length of query string. May indicate malicous location,tbd,corelight_dns
lots of txt requests with long lengths may indicate c2,tbd,corelight_dns
heartbeat requests may be indicator of c2,tbd,corelight_dns
identify AD controllers using service dns requests,tbd,corelight_dns
ssh bruteforce password guessing,tbd,corelight_ssh
ssh connections to non-standard port (not 22),tbd,corelight_ssh
non-standard algorithms,tbd,corelight_ssh
non-standard clients,tbd,corelight_ssh
external to internal ssh communication,tbd,corelight_ssh
identify new systems that are using SSH based off baseline,tbd,corelight_ssh
PUT and DELETE http methods,tbd,corelight_http
500 alert types can be an indicator of attack,tbd,corelight_http
non-standard rdp port,tbd,corelight_rdp
identify new systems that are using rdp based off baseline,tbd,corelight_rdp
identify new cookies / usernames being used in rdp connections,tbd,corelight_rdp
ica field in an http log indicates citrix usage.  ,tbd,corelight_http
